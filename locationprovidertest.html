<!DOCTYPE html>
<html>
<head>
  <!-- Standard Meta -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <!-- Site Properties -->
  <title>Location Provider test page</title>
  <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.3/dist/semantic.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.3/dist/semantic.min.js"></script>

  <script>
  $(document)
    .ready(function() {
        
        /* local test
        var fakecontent = [
            { title: 'Andorra' },
            { title: 'United Arab Emirates' },
            { title: 'Afghanistan' },
            { title: 'Antigua' },
            { title: 'Anguilla' },
            { title: 'Albania' }
          ];
        $('.ui.search').search({ source: fakecontent });
        */

        //https://stackoverflow.com/questions/28782521/how-can-you-modify-the-results-in-semantic-ui-search-module
        $('.ui.search').search({ 
            apiSettings: {
                url: 'https://nominatim.openstreetmap.org/search?format=json&countrycodes=it&q={query}',
                onResponse: function(apiresponse) {
                    //questo metodo è necessario per manipolare la risposra dell'api, il controllo si aspetta l'array dei risultati in una proprieta della response e non nella root
                    //se fosse stato cosi bastava rimappare i field dell'api con quelli del controllo search tramite la proprietà "fields" 
                    console.log(apiresponse);

                    var response = { 
                        results: []  //[{"title" : "aaaaa"},{"title" : "bbbb"}]
                    };

                    $.each(apiresponse, function (index, item) {
                        response.results.push({
                            title: item.display_name
                        });
                    });

                    return response;
                }
            },
            fields: {
                results : 'results',
                title   : 'title' //,
                //url     : 'display_name'
            },
            minCharacters : 3,
            searchDelay: 350
        });



         /* result example
            [
                {
                    "place_id": "178104436",
                    "licence": "Data © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright",
                    "osm_type": "relation",
                    "osm_id": "41485",
                    "boundingbox": [
                        "41.6556417",
                        "42.1410285",
                        "12.2344669",
                        "12.8557603"
                    ],
                    "lat": "41.8933203",
                    "lon": "12.4829321",
                    "display_name": "Roma, RM, LAZ, Italia",
                    "class": "place",
                    "type": "city",
                    "importance": 0.82686368688662,
                    "icon": "https://nominatim.openstreetmap.org/images/mapicons/poi_place_city.p.20.png"
                },
                {
                    "place_id": "178486693",
                    "licence": "Data © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright",
                    "osm_type": "relation",
                    "osm_id": "41313",
                    "boundingbox": [
                        "41.4075808",
                        "42.2969953",
                        "11.7337425",
                        "13.2962768"
                    ],
                    "lat": "41.85233365",
                    "lon": "12.6308541512038",
                    "display_name": "RM, LAZ, Italia",
                    "class": "boundary",
                    "type": "administrative",
                    "importance": 0.45,
                    "icon": "https://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png"
                }
            ]
            */

    });
  </script>
</head>
<body>
<div class="ui container">
    <!-- with semantic-ui search [autocomplete] -->
    <div class="ui segment">
        <h1 class="ui header">Semantic-ui Search module - autocomplete</h1>

        <div class="ui search">
            <input class="prompt" type="text" placeholder="Places...">
            <div class="results"></div>
        </div>
    
    </div>
</div>
</body>
</html>
